const { join } = require('path');
const cds = require('../../../cds')
const { exists } = cds.utils
const { copyFiles } = require('../../util/template')
const { URLS } = require('../../constants')
const LOG = console

module.exports = class PipelineTemplate extends require('../templateBase') {


    async canRun() {
        if (this.options.force) {
            return true;
        }

        if (exists('Jenkinsfile') || exists(join('.pipeline', 'config.yml'))) {
            throw `Pipeline support file exists. Use --force to overwrite.`
        }

        return true;
    }

    async run() {
        await copyFiles(join(__dirname, 'files'), cds.root, {}, this.options.force);
    }

    async finalize() {
        LOG.info(`For information on project "Piper" and its pipelines see ${URLS.PIPELINE_HELP}`);
    }
}
