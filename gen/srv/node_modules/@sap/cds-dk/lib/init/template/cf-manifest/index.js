const { join } = require('path')
const cds = require('../../../cds')
const { exists } = require('../../../cds').utils
const { readProject } = require('../../util/projectReader')
const { copyFiles } = require('../../util/template')
const MANIFEST_FILE = 'manifest.yml'
const SERVICES_MANIFEST_FILE = 'services-manifest.yml'

module.exports = class CfManifestTemplate extends require('../templateBase') {

    async canRun() {
        if (this.options.force) {
            return true
        }
        if (exists(MANIFEST_FILE) || exists(SERVICES_MANIFEST_FILE)) {
            throw `File ${MANIFEST_FILE} or ${SERVICES_MANIFEST_FILE} already exist in current folder. Use --force to overwrite.`
        }
        return true
    }

    async run() {
        const project = await readProject()
        await copyFiles(join(__dirname, 'files'), cds.root, project, this.options.force)
    }
}
