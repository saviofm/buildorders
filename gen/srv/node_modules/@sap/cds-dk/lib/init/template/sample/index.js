const { join } = require('path')
const cds = require('../../../cds'), { exists } = cds.utils
const { readProject } = require('../../util/projectReader')
const { copyFiles } = require('../../util/template')

module.exports = class SampleTemplate extends require('../templateBase') {

    async canRun() {
        const { isJava } = await readProject(this.options)
        if (isJava) throw `'cds add sample' is not available for Java yet`
        return true
    }

    async run() {
        const { db, srv, app } = (await this.getEnv()).folders
        const language = exists('pom.xml') ? 'java' : 'nodejs'
        await Promise.all([
          copyFiles(join(__dirname, 'files', 'db'),  db, {}, this.options.force),
          copyFiles(join(__dirname, 'files', 'app'), app, {}, this.options.force),
          copyFiles(join(__dirname, 'files', 'srv'), srv, {}, this.options.force),
          copyFiles(join(__dirname, 'files', language), srv, {}, this.options.force)
        ])
    }
}
