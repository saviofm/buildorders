const cds = require('../../cds');
const { getMessage } = require('./logging');

const DEBUG = cds.debug('cli');

class CliError extends Error {
    // noinspection JSAnnotator
    constructor(message, { error, command } = {}) {
        const help = command && getCommandHelp(command);
        const stackLimit = Error.stackTraceLimit;
        if (!DEBUG) {
            Error.stackTraceLimit = 0
        }
        super(getMessage(message, { error, help }));
        Error.stackTraceLimit = stackLimit;
    }
}

function getCommandHelp(command) {
    const cli = require('../../../bin/cds');
    return cli?.load(command, () => ({ help: '' }))?.help ?? '';
}

module.exports = {
    CliError
};
