const fs = require('fs')
const cds = require('../cds')
const BuildTaskEngine = require('./buildTaskEngine')
const BuildTaskFactory = require('./buildTaskFactory')
const BuildTaskHandler = require('./buildTaskHandler')
const { BuildError } = require('./util')

module.exports = { build, BuildTaskFactory, BuildTaskEngine, BuildTaskHandler, BuildError }

/**
 * Executes cds build in the directory defined by cds.root.
 *
 * @param {object} options - command options as defined by build command.
 */
async function build(options = {}) {
    if (!fs.existsSync(cds.root) || !fs.lstatSync(cds.root).isDirectory()) {
        const { CliError } = require('../client/helper/errors')
        throw new CliError(`Project folder '${cds.root}' does not exist`)
    }
    return await new BuildTaskEngine(options).processTasks()
}